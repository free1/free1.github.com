---
layout: post
title: rails部署到Linux
category: ruby
description: 部署
disqus: false
---

## 免密码登录
* `ssh-keygen -t rsa` 本地机器生成key
* `scp -r id_rsa.pub root@ip:/root` 复制本地key到远程机器
* 在 `cp id_rsa.pub ~/.ssh/authorized_keys` 复制key到authorized_keys

## 创建部署用户
* `useradd -m -s /bin/bash deploy` 生成用户
* `adduser deploy sudo` 将用户加入 sudo 群组
* 或者 `adduser deploy --ingroup sudo`
* `passwd deploy` 设置密码

## [安装必要组件](https://github.com/huacnlee/init.d)
* `sudo apt-get update`
* `sudo apt-get install curl`
* `sudo apt-get install git`
* `sudo apt-get install libssl-dev`
* `sudo apt-get install mysql-server mysql-client libmysqlclient-dev`
* `sudo apt-get install nodejs`

## 安装nginx

```
DIR=`pwd`
VERSION='1.4.4'
cd /tmp
curl -O http://nginx.org/download/nginx-$VERSION.tar.gz
tar zxf nginx-$VERSION.tar.gz
cd nginx-$VERSION
./configure
make && sudo make install
```

`sudo nginx -t` 检查安装结果
`sudo nginx -s stop` 停止
`sudo nginx -s reload` 重载

## unicorn

* `bundle exec unicorn -D -c config/unicorn.rb -E production` 启动unicorn

## [rbenv安装ruby](https://ruby-china.org/wiki/rbenv-guide)
* clone项目
```
git clone git://github.com/sstephenson/rbenv.git ~/.rbenv
# 用来编译安装 ruby
git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
# 用来管理 gemset, 可选, 因为有 bundler 也没什么必要
git clone git://github.com/jamis/rbenv-gemset.git  ~/.rbenv/plugins/rbenv-gemset
# 通过 gem 命令安装完 gem 后无需手动输入 rbenv rehash 命令, 推荐
git clone git://github.com/sstephenson/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash
# 通过 rbenv update 命令来更新 rbenv 以及所有插件, 推荐
git clone https://github.com/rkh/rbenv-update.git ~/.rbenv/plugins/rbenv-update
```

* 然后把下面的代码放到 ~/.bash_profile 里

```
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"
```

注意 Unubtu请放到 ~/.bashrc 里, zsh用户是 ~/.zshrc

然后重开一个终端就可以执行 rbenv 了.

